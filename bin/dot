#!/bin/zsh
#
# dot
#
# `dot` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.

info () {
  printf "  [ \033[00;34m..\033[0m ] $1"
}

user () {
  printf "\r  [ \033[0;33m?\033[0m ] $1 "
}

success () {
  printf "\r\033[2K  [ \033[00;32mOK\033[0m ] $1\n"
}

fail () {
  printf "\r\033[2K  [\033[0;31mFAIL\033[0m] $1\n"
  echo ''
  exit
}

info "Updating dotfiles"
cd $DOTFILES
git pull 1> /dev/null
success "dotfiles updated."

vim_folder=$DOTFILES/vim/vim.symlink

# Parallelized git-pulls for vim plugins
for i in `ls $vim_folder/bundle`
    echo "cd $vim_folder/bundle/$i ; git pull" >> /tmp/vim_plugins_commands
plugins_number=`wc -l < /tmp/vim_plugins_commands`
< /tmp/vim_plugins_commands xargs -P $plugins_number -d '\n' -I {} sh -x -c "{}"
rm /tmp/vim_plugins_commands

info "Backing up parus"
rsync -av -e ssh parus:backup $HOME/.backup/parus/
success "parus backed up."

success "You can have fun now !"
